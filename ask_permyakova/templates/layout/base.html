{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap.min.css' %}" />
    <title>Document</title>
</head>
<body>
    <nav class="navbar bg-body-tertiary">
    <div class="container-fluid">
        <a href="{% url 'index' %}" class="navbar-brand text-decoration-none">AskPermyakova</a>
        <form class="d-flex" role="search">
          <div class="dropdown">
            <input class="form-control me-2" 
                  id="search-input"
                  type="search" 
                  placeholder="Search" 
                  aria-label="Search"
                  data-bs-toggle="dropdown">
            
            <ul class="dropdown-menu w-100" id="search-results">
                <!-- <li><span class="dropdown-item-text">Type to search...</span></li> -->
                <li><a class="dropdown-item" href="#">Example result 1----------------</a></li>
                <li><a class="dropdown-item" href="#">Example result 2</a></li>
            </ul>
          </div>
          <!-- <button class="btn btn-outline-success" type="submit">Ask!</button> -->
          <a href="{% url 'ask' %}" class="btn btn-outline-success">Ask!</a>
        </form>
        
        {% if profile %}
          <div class="d-flex gap-2 align-items-center">
            <div class="image">
              <img src="{{ profile.avatar.url }}" alt="img"
                  style="width: 50px; height: 50px; object-fit: cover;" />
            </div>
            <div class="content">
              <div class="navbar-brand"> {{ profile.user.username }} </div>
              <div class="d-inline link-opacity-50-hover"> <a href="{% url 'settings' %}">Settings</a> </div>
              <div class="d-inline link-opacity-50-hover"> <a href="{% url 'logout' %}">Log out</a> </div>
            </div>
          </div> 
        {% else %}
        <div class="d-flex gap-2 align-items-center">
            <div class="d-inline link-opacity-50-hover"> <a href="{% url 'login' %}">Log in</a> </div>
            <div class="d-inline link-opacity-50-hover"> <a href="{% url 'registration' %}">Register</a> </div>
        </div> 
        {% endif %}

    </div>
    </nav>

    {% block content %} 
    {% endblock %}

    <script src="{% static 'bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'app.js' %}"></script>
</body>

<script>
let searchTimer;
const searchInput = document.getElementById('search-input');
if (searchInput) {
    
    const newInput = document.getElementById('search-input');
    newInput.addEventListener('input', function(e) {
        console.log('Input event:', e.target.value); 
        
        clearTimeout(searchTimer);
        searchTimer = setTimeout(() => {
            searchQuestions(e.target.value.trim());
        }, 500); 
    });
}

function searchQuestions(query) {
    if (query.length < 2) {
        return;
    }
    
    fetch(`/search/question/?q=${encodeURIComponent(query)}`)
        .then(r => r.json())
        .then(data => {
            const results = document.getElementById('search-results');
            if (data.results.length === 0) {
                results.innerHTML = '<li><span class="dropdown-item-text">No results</span></li>';
                return;
            }
            
            let html = '';
            data.results.forEach(item => {
                html += `<li><a class="dropdown-item" href="${item.url}">${item.title}</a></li>`;
            });
            results.innerHTML = html;
            
            new bootstrap.Dropdown(document.getElementById('search-input')).show();
        });
}
</script>
</html>